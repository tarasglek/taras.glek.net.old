
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>All About Performance</title>
  <meta name="author" content="Taras Glek">

  
  <meta name="description" content="End of summer is a tough time to make progress because a lot of people are on vacation. Surprisingly, Firefox got some good fixes in since the last &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://taras.glek.net/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="All About Performance" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">All About Performance</a></h1>
  
    <h2>and other stuff by Taras Glek</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">All RSS</a></li>
  
  <li><a href="/blog/categories/mozilla/atom.xml" rel="subscribe-rss" title="subscribe via RSS">Mozilla RSS</a></li>
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/04/snappy-38/">Snappy #38: Responsiveness Fixes Galore</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-04T02:17:48-07:00" pubdate data-updated="true">Sep 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>End of summer is a tough time to make progress because a lot of people are on vacation. Surprisingly, Firefox got some good fixes in since the last update.</p>

<p><strong>Less Slow Startups</strong></p>

<p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=726125">Bug 726125</a>: should get rid of a lot of super-slow startups. Due to an abstraction accident we ended up validating jars more eagerly than expected. Firefox would go on the net (on the main thread) to check the certificate every time a signed jar was opened. There are over 500 signed extensions on AMO with over 14million active users. See the following for background on the (now dead) feature that caused our jar code to go nuts: <a href="http://www.mozilla.org/projects/security/components/signed-scripts.html">signed scripts</a> and <a href="https://developer.mozilla.org/en-US/docs/Bypassing_Security_Restrictions_and_Signing_Code">note on removal of signed script</a> support. Thanks for Nicholas Chaim and Vladan Djeric for fixing this.</p>

<p><strong>Less Proxy Lag (WIP)</strong></p>

<p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=769764#c5">Bug 769764</a>. We have received a lot of strange complaints about Firefox network performance that we could never reproduce. Turned out this was because none of us used proxies. Patrick McManus discovered a lot of synchronous proxy and DNS code in our network stack.</p>

<p>Fix for this should also improve performance for people without proxies since proxy-autodetection code was also doing main thread IO. As a result all of us replacing sync APIs with async ones all of the existing proxy-related addons will have to be updated. Patrick is reaching out to addon authors to make sure addons are updated in time for the next release.</p>

<p><strong>Less UI Repaint Lag</strong></p>

<p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=786421">Bug 786421</a>: Nightlies got unbearably slow for me recently. Turned out we ended continuously resizing + applying theme + redrawing invisible tooltips on every paint. Thanks for Timothy Nikkel for fixing this. This bug never affected anyone outside of the Nightly/Aurora testers, but it serves as yet another example of how the <a href="https://developer.mozilla.org/en-US/docs/Performance/Profiling_with_the_Built-in_Profiler">Gecko Profiler</a> makes it easier than ever to diagnose weird performance problems. The single biggest contribution anyone can do at the moment is to provide instructions of how to reproduce lag with accompanying profiler traces.</p>

<p><strong>Less Gradient Lag</strong></p>

<p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=761393">Bug 761393</a>: Paul Adenot implemented a gradient cache. This was landed as a Telemetry experiment so we can determine what the optimal cache retention strategy is. We&#8217;ll be watching the relationship between GRADIENT_DURATION and GRADIENT_RETENTION_TIME in the coming weeks. Currently rendering gradients cause stalls in the GPU pipeline. In previous experiments we found out that most of the tab-switch rendering time in hardware-accelerated Firefox is spent rendering gradients :(. Gradients are hard to notice for casual users, but they are heavily used in our tab strip and on Google web properties.</p>

<p><strong>MozCamp</strong></p>

<p>I may not have a chance to post the next snappy update as I&#8217;ll be hopping on the plane to Warsaw right after our meeting. If you are attending MozCamp come to our <a href="https://wiki.mozilla.org/index.php?title=MozCampEU2012/Schedule/Desktopandmobile/All-About-Performance">&#8216;All About Performance&#8217; session</a>. Our goal for the talk is to significantly expand the pool of people who can diagnose Firefox (and web) performance problems.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/29/dxr-now-does-live-regexp-search-thanks-google-code/">DXR Now Does Live Regexp Search, Thanks Google Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-29T06:56:03-07:00" pubdate data-updated="true">Aug 29<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Google code was once the best code-search tool in the business. Then it got shut down, except for a few special instances like <a href="http://code.google.com/p/chromium/source/search?q=Startup.BrowserMessageLoopStartTime&amp;origq=Startup.BrowserMessageLoopStartTime&amp;btnG=Search+Trunk">chromium</a>.</p>

<p>Our intern, Jonas Finnemann Jensen, took the re2 code that used to power google code search and integrated it into DXR (among other cleanups). See his blog <a href="http://jonasfj.dk/blog/2012/08/regular-expressions-on-dxr-allizom-org/">post </a>for more details.</p>

<p>Regexps combined with the new instant search feature changed how I search Mozilla code. Instant search means that I&#8217;m constantly refining my search terms to narrow down my results to a minimum before I leave the search page. Digging through Mozilla code is pretty fun now. I believe our development instance* of <a href="http://dxr.allizom.org/search?q=&amp;tree=mozilla-central&amp;redirect=true">DXR</a> is the most pleasant./efficient (even if a bit rough) code indexing solution atm. I no longer miss google code for searching Mozilla.</p>

<p>Now that Mozilla can be searched in a pleasant way, something needs to fill the searching of masses of open source code usecase. Perhaps <a href="https://github.com/">github</a> could plug the &#8220;google code&#8221;-sized gap in developer hearts?</p>

<ul>
<li>we also need to stabilize the development version and move it to <a href="http://dxr.mozilla.org/">dxr.mozilla.org</a>.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/23/snappy-37/">Snappy #37</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-23T09:10:49-07:00" pubdate data-updated="true">Aug 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Highlights from <a href="https://wiki.mozilla.org/Performance/Snappy/2012-08-23#Incoming">meeting note</a>s for today:</p>

<ul>
<li>Tim Taubert worked on Firefox UI speedups</li>
<li>Lots of improvements to the profiler from Benoit Girard</li>
<li>More incremental GC work from Jon Coppeard</li>
<li>Vladan Djeric got all of the security reviews and should be able to land Nicholas Chaim&#8217;s fix for networked certificate validation:<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=726125"> bug 726125</a>
We spent most of the meeting discussing bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=784512">bug 784512</a>. According several data sources Firefox 15 Beta loads pages slower than 14. Occasionally problems squeeze past our performance testing + telemetry infrastructure, this looks like one of these times. Unfortunately, it&#8217;s quite hard to reduce a few noisy signals to a concrete performance problem. If you can reproduce a performance regression to do with loading webpages/games/etc in FF15 vs FF14, please leave a comment.</li>
</ul>


<p><strong>Thanks!</strong></p>

<p>Thanks for the great comments on my <a href="http://taras.glek.net/blog/2012/08/16/snappy-36/">previous </a>snappy updates. <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=783755">Bug 783755</a> should take care of the new cache size pref not sticking. <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=718910">Bug 718910</a> on hiding Cache directory from Spotlight is making progress too.</p>

<p>Commenter, kumalos, reported a tab switching regression and posted a profile recorded with our <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;ved=0CCIQFjAA&amp;url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FPerformance%2FProfiling_with_the_Built-in_Profiler&amp;ei=FLw2UKzMO4WXiQLSgoHwAQ&amp;usg=AFQjCNEGPmI44wGwpjRbtR-WT36EdVv-ew">profiler </a>as evidence. This proved to be an example of bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=783748">783748</a>, and lead us to identify a previously unknown issue in bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=784756">784756</a>. Constructive feedback like this is one of the main reasons I blog.</p>

<p>I highly encourage users interested in improving Firefox performance to use Nightly builds and report bugs with profiler traces attached.</p>

<p><strong>Shutdown Times</strong></p>

<p>I&#8217;ll end with our latest Telemetry data point. This one took a while to get right, but we finally track our shutdown speed.</p>

<p><a href="http://taras.glek.net/blog/files/2012/08/shutdown.png"><img src="/assets/images/2012-08-23-snappy-37/shutdown-300x157.png" alt="" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/16/trilite-fast-string-matching-in-sqlite/">TriLite, Fast String Matching in Sqlite</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-16T09:51:20-07:00" pubdate data-updated="true">Aug 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the limitations of the SQLite FTS is that it can&#8217;t do regular expression or substring searches. Jonas is addressing this with <a href="http://jonasfj.dk/blog/2012/08/trilite-fast-string-matching-in-sqlite/">TriLite</a>. Be sure to subscribe to Jonas&#8217; blog for exciting DXR developments coming up within the final two weeks of his internship.</p>

<p>Coming to our test <a href="http://dxr.allizom.org/">DXR instance</a> soon&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/16/snappy-36/">Snappy #36</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-16T07:24:19-07:00" pubdate data-updated="true">Aug 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>Misc</strong></p>

<p>I have been using dates to mark passage of time in the Snappy project. I think I&#8217;ll switch to a simple counter instead. We are ~36 updates into this project.</p>

<p><strong>Blogging</strong></p>

<p>Ludovic Hirlimann <a href="http://sietch-tabr.tumblr.com/post/29404692899/firefox-cache-and-spotlight">blogged</a> about how spotlight spends a lot of time indexing the Firefox network &#8216;Cache&#8217; directory (known problem, bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=718910">718910</a>). If you experience this problem and would like to see it fixed, please comment in the bug if the <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=718910#c13">suggested remedy</a> helps.</p>

<p>Tim Taubert <a href="http://timtaubert.de/blog/2012/08/snappy-fixing-new-tab-page-performance-regressions/">wrote</a> about reducing new-tab jank. I mention Tim a lot in these updates. He takes on a lot of interesting bugs in Firefox frontend. Hopefully he&#8217;ll make a habit out of blogging about his work.</p>

<p><strong>Networking</strong></p>

<p>Nick Hurley landed a change to reduce our maximum cache size to 350 megabytes. In order to avoid excessive disk IO traffic old cache size of 1 gigabyte remains in effect until the cache is reset. See bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=709297">709297</a> and Nick&#8217;s <a href="http://todesschaf.org/posts/2012/07/25/cache-usage-results.html">blog post</a> for more details. Progress is also being made on <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=777328">bug 777328</a> so we can move towards not blowing away our cache 10-20% of the time.</p>

<p>Michal Novotny is proceeding with incrementally reducing cache-caused jank that&#8217;s due to holding a lock on the main thread while doing IO on a background thread. He also removing a multitude of synchronous necko APIs, see <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=695399">bug 695399</a>.</p>

<p>Patrick McManus is removing synchronous proxy-related code, see <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=766973">bug 766973</a> for the DNS-related bit. Turns out our proxy code also does all kinds of synchronous operations when detecting proxy configuration, etc. This is being worked on, but hasn&#8217;t been filed yet.</p>

<p>I usually try to highlight work that has already landed, but in this case it is important to point out that the Necko team is working hard on addressing significant problems in the networking code. These problems are tricky and will take a while to fix. The team is relatively new and is still discovering hidden surprises in their codebase.</p>

<p><strong>Profiler</strong></p>

<p>Benoit Girard posted a <a href="http://dl.dropbox.com/u/10523664/Screenshots/5p.png">preview </a>of view-source in the profiler. This will be handy for figuring out where performance problems lay, especially in JS files that have been preprocessed (our JS preprocessor does not try to keep the line numbers sane).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/15/dxr-is-back-at-dxr-mozilla-org/">DXR Is Back at dxr.mozilla.org</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-15T03:59:04-07:00" pubdate data-updated="true">Aug 15<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For a while DXR lived on a <a href="http://dxr.lanedo.com/">lanedo.com</a> server. Lanedo folks are now done with DXR development. DXR is once again deployed at dxr.mozilla.org. Our Perf intern, Jonas, is driving DXR development this summer. See his <a href="http://jonasfj.dk/blog/2012/08/deploying-dxr-on-dxr-mozilla-org/">progress report</a>. Be sure to subscribe to his blog. He may change how you use DXR as a result of his current work.</p>

<p><em>PS. Mozilla interns rule</em></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/14/snappy-for-aug-9/">Snappy for Aug 9</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-14T05:52:00-07:00" pubdate data-updated="true">Aug 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lawrence took excellent Snappy <a href="https://wiki.mozilla.org/Performance/Snappy/2012-08-09">meeting notes</a> last week.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/06/snappy-aug-2/">Snappy, Aug 2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-06T09:27:10-07:00" pubdate data-updated="true">Aug 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>Landed This Week</strong></p>

<p>Neil Deakin joined the Snappy effort. He is working on eliminating pointless reflows in the tab strip. His fix for <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=752486">bug 752486</a> landed, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=752376">752376</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=752496">752496</a> are next.</p>

<p>Brian Bondy landed removal of our prefetch-nuking code in bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=770911">770911</a>. xul.dll preload is now always on based on our telemetry startup study in bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=765850">765850</a>.</p>

<p>Bill McCloskey landed the following improvements to reduce garbage collection pauses:</p>

<ul>
<li>bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=777919">777919 </a>- Free LifoAlloc chunks on background thread, instead of as part of the final IGC slice. This isn&#8217;t a problem for most people, but for some people on OSX it can take anywhere from 50ms to 250ms or more.</li>
<li>bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=778993"> 778993 </a>- Separate runtime&#8217;s gcMallocBytes from compartment&#8217;s gcMallocBytes, so we trigger less non-incremental GCs with many tabs open</li>
<li>bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=767209">767209 </a>- Make GC slices longer when not painting to avoid non-incremental GCs.
See Bill&#8217;s comments in bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=767209">767209</a> for some insight into the complex heuristics that go into minimizing GC interruptions: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=767209#c3">comment 1</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=767209#c8">comment 2</a>.</li>
</ul>


<p><strong>Coming Soon</strong></p>

<p>In the coming week I expect to see some good optimizations land for page rendering, tab-switching behavior, more robust cache, etc.</p>

<p>Some Snappy people will be attending <a href="https://wiki.mozilla.org/MozCampEU2012">MozCamp.eu 2012</a> in Warsaw, Poland on September 8, 9. Expect to see lots of talk on profiling and other performance tools.</p>

<p>I hope to have above 15-20 Performance/Snappy people in Warsaw for the following week. This is not yet finalized. At the moment we are looking to see if there is a coworking space or a company in Warsaw who could host us.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/26/snappy-july-26-go-try-the-gecko-profiler/">Snappy, July 26: Go Try the Gecko Profiler!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-26T08:43:17-07:00" pubdate data-updated="true">Jul 26<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>See raw <a href="https://wiki.mozilla.org/Performance/Snappy/2012-07-26">notes</a> for details on mid-flight snappy work.</p>

<p><strong>Checkout the SPS Profiler</strong>!</p>

<p><a href="https://developer.mozilla.org/en/Performance/Profiling_with_the_Built-in_Profiler">SPS Gecko Profiler</a> has gotten a lot of praise this week on #perf. If you ever wonder the hell Firefox is doing with your CPU, give the profiler a try. For the past couple of weeks it has been able to label stacks with JS, URLs and even favicons. It&#8217;s likely that Mozilla may have shipped the world&#8217;s first profiler to feature favicons.</p>

<p>Having JS support is nice, it lead to the first 2 snappy addon bugs: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=777266">777266</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=777397">777397</a>. I documented how to act on addon responsiveness issues in the <a href="https://wiki.mozilla.org/Performance/Snappy#Snappy_Addons">snappy wiki</a>.</p>

<p>Whether you develop web pages, addons or are a core gecko hacker, the profiler may make the performance-analysis part of your life much more pleasant. Update: Benoit Girard <a href="http://benoitgirard.wordpress.com/2012/07/27/javascript-profiling-with-the-gecko-profiler-and-js-anti-pattern/">wrote</a> about the new profiler features.</p>

<p><strong>Things To Not Do On Startup </strong></p>

<p>Blair McBride did some <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=726125#c16">digging</a>, there may be 15million users with signed extensions which can cause Firefox to do network IO (ie stall for a long time) on startup.</p>

<p>Brian Bondy landed a fix to lower IO priority of nuking our cache: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=773518">773518</a>. According to telemetry, 10-20% of startups feature cache nuking. It take a while to blow away 1GB of files on startup. Brian used telemetry to investigate causes for cache purges in bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=774146">774146</a>. Based on this data, Brian will begin tackling what may be the oldest snappy bug so far: bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=105843">105843</a>. For more details on our cache see Nick Hurley&#8217;s <a href="http://todesschaf.org/posts/2012/07/25/cache-usage-results.html">blog post</a> (also see his link to a similar blog post from a Chrome person).</p>

<p><strong>More Responsive Tabs</strong></p>

<p>Tim Taubert made our new tab animation more pleasant in bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=716108">716108</a>. Tim also landed a fix to halve jank caused by thumbnail capture in bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=774811">774811</a>, this should result in better tab-switching experience. Stay tuned for more developer attention in this area.</p>

<p><strong>GC</strong></p>

<p>Jon Coppeard enabled incremental sweeping: bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=729760">729760</a>. This should result in slightly smaller GC pauses.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/25/telemetry-and-what-it-is-good-for-part-2-telemetry-achievements/">Telemetry and What It Is Good for: Part 2: Telemetry Achievements</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-25T08:55:21-07:00" pubdate data-updated="true">Jul 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>An inquisitive mind sent me an email with a pointed question:</p>

<p>&#8220;Is there an example of someone who&#8217;s not you that had a burning question that would drive some sort of research or development activity and got it answered by telemetry?&#8221;</p>

<p>I forwarded his email and got a pretty fun survey. See below for a slightly edited version of emails I got. In addition to positive experiences below, people had a lot of complains about the telemetry experience.</p>

<p><em>Justin Lebar</em> Justin is probably the most vocal telemetry user who isn&#8217;t me. He <a href="http://jlebar.com/2012/5/30/A_ghost_story.html">blogged</a> about one of his more successful telemetry experiences. <em>Andrew McCreight</em> One telemetry stat I added is <a href="https://metrics.mozilla.com/data/content/pentaho-cdf-dd/Render?solution=metrics2&amp;path=%2Ftelemetry&amp;file=telemetryHistogram.wcdf&amp;bookmarkState={%22impl%22%3A%22client%22%2C%22params%22%3A{%22startDate%22%3A%222012-06-25%22%2C%22endDate%22%3A%222012-07-24%22%2C%22appVersion%22%3A%22%22%2C%22appName%22%3A%22Firefox%22%2C%22arch%22%3A%22%22%2C%22OS%22%3A%22%22%2C%22version%22%3A%22%22%2C%22channel%22%3A%22nightly%22%2C%22reason%22%3A%22idle-daily%22%2C%22appBuildID%22%3A%22%22%2C%22fromPlatformBuildID%22%3A%22%22%2C%22toPlatformBuildID%22%3A%22%22%2C%22excludeParam%22%3A%22%22%2C%22measure%22%3A%22CYCLE_COLLECTOR_NEED_GC%22%2C%22histogramCompareParam%22%3A%22appVersion%22%2C%22histogramVariablesParam%22%3A%22%22%2C%22platformBuildIDMode%22%3A%22LATEST%22%2C%22platformBuildIDTopCount%22%3A%2230%22%2C%22conditionsStatistic%22%3A%22%23conditionsStatistic%22%2C%22submissionsParameter%22%3A[[172394]]}}">CYCLE_COLLECTOR_NEED_GC</a>.  Sometimes a read barrier fails and we need to do a GC synchronously at the start of a CC, which is terrible for pause times.  Using telemetry, I confirmed my suspicion that this is very rare, and thus not worth trying to improve. Another state Olli added is <a href="https://metrics.mozilla.com/data/content/pentaho-cdf-dd/Render?solution=metrics2&amp;path=%2Ftelemetry&amp;file=telemetryEvolution.wcdf&amp;bookmarkState=%7B%22impl%22%3A%22client%22%2C%22params%22%3A%7B%22referenceDate%22%3A%222012-07-25%22%2C%22appNameParameter%22%3A%22%5BApplication%5D.%5BFirefox%5D%22%2C%22osParameter%22%3A%22%5BOS%5D.%5BWINNT%5D%22%2C%22channelParameter%22%3A%22%5BChannel%5D.%5Bnightly%5D%22%2C%22reasonParameter%22%3A%22%5BReason%5D.%5Bidle-daily%5D%22%2C%22histogramParameter%22%3A%22%5BHistogram%5D.%5BFORGET_SKIPPABLE_MAX%5D%22%2C%22histogramPopupTools%22%3A%22%22%2C%22duplicateHistogram%22%3A%22%23duplicateHistogram%22%2C%22medianButtonParam%22%3A0%2C%22scatterChart%22%3A%22%22%7D%7D">FORGET_SKIPPABLE_MAX</a>, which tracks the length of the CC cleanup phases we run.  As we made the cleanup more and more thorough, the times of these got longer and longer.  I think eventually this led Olli to try to fix the worst case cleanup phases, in bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=747675">747675</a>.  He had this comment in there: &#8220;Based on the initial telemetry data, the patch doesn&#8217;t affect too much to the already low median times, but helps significantly with the worst 5%, so mean time decreases quite nicely.&#8221; Also, back around Firefox 13, Olli was using telemetry to observe the results of various CC optimizations, to assess their effectiveness, which he then used to decide whether or not to nominate various patches for landing on Aurora 12.  Telemetry let us see the reward part of the risk vs. reward tradeoff, and get some pretty big improvements into 12. Locally, I use <a href="https://addons.mozilla.org/en-US/firefox/addon/abouttelemetry/">about:telemetry</a> to get a sense of what the behavior on my local machine has been, but I suppose that doesn&#8217;t really fall under &#8220;telemetry&#8221; per se.  But it was quite useful during the Cycle Collector Crisis to see what CC behavior people had been seeing on their machines.</p>

<p><em>Olli Pettay</em> Thanks Andrew, very accurate summary of what I&#8217;ve been doing I tend to look at CC telemetry data daily. I very rarely use the histogram, since evolution is more interesting to me. Especially median time and also how P75 and P95 evolve. (The focus in this Q is to get lower bad times, so we should manage to drop P75 and P95) I use also <a href="about:telemetry">about:telemetry</a> locally since I tend to run builds with some patch, and I want to see if they affect badly to CC or GC times.</p>

<p><em>Taras</em> My blog is basically a collection of telemetry trivia :) I do not have testimonials from other people. However I heard that the silent-update team proved something about silent updates with telemetry, Necko team discovered that some optimizations were not, etc. I encourage other people who solved a problem with telemetry to either wrote a blog post or leave a comment.</p>

<p>In part 3 I will cover flaws in the current Telemetry experience.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/12/17/hello-octopress/">Hello Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/26/coping-with-flash-hangs/">Coping with Flash hangs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/16/snappy-44-fixing-tab-switching-in-vancouver/">Snappy #44: Fixing tab switching in Vancouver</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/05/snappy-43-big-improvements-faster-startup-smoother-tabstrip/">Snappy #43: Big improvements: faster startup? Smoother tabstrip!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/26/snappy-42/">Snappy #42</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("tarasglek", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tarasglek" class="twitter-follow-button" data-show-count="false">Follow @tarasglek</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Taras Glek -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'allaboutperformance-tarasglek';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
