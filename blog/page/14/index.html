
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>All About Performance</title>
  <meta name="author" content="Taras Glek">

  
  <meta name="description" content="In an earlier post I described my Fiji hack: how to use some nasty instrumentation to spit out ld scripts to speed up cold startup. This week I tried &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://taras.glek.net/blog/page/14/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  
  <link href="/atom.xml" rel="alternate" title="All About Performance" type="application/atom+xml">
  
  

</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" title="subscribe via RSS">All RSS</a></li>
  
  <li><a href="/mozilla.xml" title="subscribe via RSS">Mozilla RSS</a></li>
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

<script>
if (!window.requestAnimationFrame) {
  window.requestAnimationFrame = window.mozRequestAnimationFrame
    || window.webkitRequestAnimationFrame
    || window.msRequestAnimationFrame;

  window.cancelAnimationFrame = window.mozCancelAnimationFrame
    || window.webkitCancelAnimationFrame
    || window.msCancelAnimationFrame;

}

window._refreshLog = []
function refreshLogCounter() {
  window._refreshLog.push(Date.now())
  window._refreshLogCounter = requestAnimationFrame(refreshLogCounter);
}

window._refreshLogCounter = requestAnimationFrame(refreshLogCounter);
</script>

</nav>
  <header role="banner"><hgroup>
  <h1><a href="/">All About Performance</a></h1>
  
    <h2>and other stuff by Taras Glek</h2>
  
</hgroup>

</header>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/03/05/mirror-mirror-on-the-wall-why-is-my-binary-slow/">Mirror, Mirror on the Wall, Why Is My Binary Slow?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-05T09:48:25-08:00" pubdate data-updated="true">Mar 5<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In an <a href="http://taras.glek.net/blog/2010/02/19/teaching-ld-to-optimize-binaries-for-startup/">earlier</a> post I described my Fiji hack: how to use some nasty instrumentation to spit out ld scripts to speed up cold startup. This week I tried to extract more data out of the binary to lay it out even better. Trouble is that even if one lays out functions perfectly, they load data for things like variable initializers which will cause more IO.</p>

<p>A very clever friend suggested that I can write a valgrind plugin that can detect data accesses and function access and write the linker input files in one step. So with much hand-holding I hacked a sample valgrind plugin to do what I <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=549749">want</a>. Unfortunately, my binaries ended up not being significantly faster(if at all) than the Fiji ones. They also ended up 20% bigger.</p>

<p>Fortunately, the GCC devs were able to point out my linker mistakes and pointed me at a <a href="http://sourceware.org/ml/binutils/2010-03/msg00050.html">linker patch</a> that does what I want without linker scripts(and has less binary-bloating side-effects). Unfortunately, that just confirmed that the speedup I was looking for wasn&#8217;t hiding behind data symbols. So I am going to have to sit down with my <a href="http://taras.glek.net/blog/2009/10/23/studying-library-io-systemtap-style/">io tracing script </a>and study what the heck is going on.</p>

<p><strong>Cool Things I Learned</strong></p>

<p>In the process of helping me, GCC people namedropped some compiler flags that may prove very helpful:</p>

<ul>
<li>-freorder-blocks-and-partition: Apparently this breaks up functions into hot/cold parts and gives them different section names so they can be moved around at link time.</li>
<li>-fno-common, -fno-zero-initialized-in-bss should go well with my favourites: -ffunction-sections -fdata-sections
Additionally, it may be possible to benefit from linking with large page support. I have some doubts about that.</li>
</ul>


<p>I did learn about some cool GNU Gold flags:</p>

<ul>
<li>&#8211;compress-debug-sections=zlib: Most of the overhead of linking a development libxul.so is writing out a near gig of debug data</li>
<li>&#8211;icf: Identical code folding, I think that matches the deduplication feature found in the ms linker. Saves 5% on my libxul.so</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/02/26/updated-dehydra-installation-instructions/">Updated Dehydra Installation Instructions</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-02-26T03:02:46-08:00" pubdate data-updated="true">Feb 26<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="https://developer.mozilla.org/En/Dehydra/Installing_Dehydra">Dehydra installation instructions</a> got to the point where they were more confusing than helpful. I spent this morning cutting out irrelevant crud, please let me know if there are any further cleanups that need to be done.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/02/19/teaching-ld-to-optimize-binaries-for-startup/">Teaching Ld to Optimize Binaries for Startup</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-02-19T03:28:51-08:00" pubdate data-updated="true">Feb 19<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have been told that it should be possible to control the way the GNU linker lays out binaries. Unfortunately until recently I couldn&#8217;t figure out the right incantations to convince ld to do my bidding. Turns out what I needed was to be stranded on a beach in Fiji with nothing better to do than to reread the ld info page a few times.</p>

<p>Recipe:</p>

<ol>
<li>Produce 2 mozilla builds: A tracing build with -finstrument-functions in CXXFLAGS/CFLAGS A release build with -ffunction-sections and -fdata-sections CXXFLAGS/CFLAGS to allow the linker to move stuff at function or static data(mostly variables) granularity</li>
<li>Link my <a href="http://people.mozilla.com/~tglek/startup/ld/profile.cpp">profile.cpp</a> into libxul in the tracing build (without -finstrument-functions flag)</li>
<li>Run the tracing build, capturing the spew from profile.cpp into a log file</li>
<li>Feed the log file to <a href="http://people.mozilla.com/~tglek/startup/ld/generate_sections_ff.py">my script</a> to produce a linker script. This will produce library.so.script files for all of Mozilla libraries.</li>
<li>Rebuild relevant libraries in the release build with -T library.so.script linker flag</li>
<li>Enjoy faster startup
This results in 200ms faster startup my 7200rpm laptop harddrive which is about a 10% of my startup. I think that&#8217;s pretty good for a proof of concept. Unfortunately there isn&#8217;t a measurable win on the SSD (not surprising) nor a reduction in memory usage (I expected one due to not having to page in code that isn&#8217;t needed for firefox startup).</li>
</ol>


<p>I suspect the problem is that data sections need to be laid out adjacent to functions that refer to them. I started sketching out a treehydra <a href="http://people.mozilla.com/~tglek/startup/ld/map_functions_and_symbols.js">script</a> to extract that info.</p>

<p>I posted the relevant testcase and scripts. Do hg clone <a href="http://people.mozilla.com/~tglek/startup/ld/">http://people.mozilla.com/~tglek/startup/ld</a> to see the simple testcase and various WIP firefox scripts.</p>

<p><strong>Long-term Expectations</strong></p>

<p>The majority of Firefox startup overhead (prior to rendering of web pages) comes from frustrating areas such inefficient libraries (eg fontconfig, gtk) and the mess caused by crappy layout of binaries and overuse of dynamic libraries. This post describes one small step towards fixing the crappy layout of our binaries.</p>

<p>I would like to end up in a world where our binaries are static and laid out such that they are read sequentially on startup (such that we can use the massive sequential read speeds provided by modern storage media). Laying out code/data properly should result in memory usage reductions which should be especially welcome on Fennec (especially on Windows Mobile).</p>

<p>I am hoping to see 30-50% startup time improvements from this work if everything goes according to plan.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/02/09/static-analysis-articles/">Static Analysis Articles</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-02-09T06:22:40-08:00" pubdate data-updated="true">Feb 9<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A really good <a href="http://cacm.acm.org/magazines/2010/2/69354-a-few-billion-lines-of-code-later/fulltext">ACM article</a> about static analysis from Coverity&#8217;s perspective has been making rounds in Mozilla. What struck me most was the following paragraph:_ _</p>

<p><em>At the most basic level, errors found with little analysis are often better than errors found with deeper tricks. A good error is probable, a true error, easy to diagnose; best is difficult to misdiagnose. As the number of analysis steps increases, so, too, does the chance of analysis mistake, user confusion, or the perceived improbability of event sequence. No analysis equals no mistake.</em></p>

<p>My personal view has been that &#8220;dumb&#8221; analyses are the most effective ones in terms of mistakes spotted vs time wasted writing/landing the analysis. It is interesting to see that sophisticated analyses are difficult to deploy even for Coverity.</p>

<p>In other news, LCA 2010 was my favourite conference so far. I met a number of awesome developers there. Mozilla&#8217;s static analysis work finally got <a href="http://lwn.net/Articles/370717/">mentioned</a> in LWN!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/21/state-of-static-analysis-at-mozilla/">State of Static Analysis at Mozilla</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-21T09:24:03-08:00" pubdate data-updated="true">Jan 21<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Mozilla has static analyses built into the buildsystem that can be turned on with &#8211;with-static-checking= flag. The analyses live in <a href="http://mxr.mozilla.org/mozilla-central/source/xpcom/analyses">xpcom/analyses</a> directory. The testcases (aka documentation) are in <a href="http://mxr.mozilla.org/mozilla-central/source/xpcom/tests/static-checker/">xpcom/tests/static-checker</a>. Analyses are implemented in either <a href="https://developer.mozilla.org/En/Dehydra">Dehydra</a> or <a href="https://developer.mozilla.org/en/Treehydra">Treehydra</a> and run within a patched GCC 4.3.</p>

<p>The currently landed checks are:</p>

<ul>
<li>final.js: Java-like &#8220;final&#8221; keyword for C++</li>
<li>flow.js: Ensure code in a function flows through a particular label</li>
<li>must-override.js: Force derived classes to override certain methods</li>
<li>override.js: Ensure methods exist in base class</li>
<li>outparams.js: Ensure outparameters and return error codes are in sync</li>
<li>stack.js: Mark classes as stack-only
A whole lot more analyses in various states of completion can be tracked in the static analysis <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=430328">bug</a>.</li>
</ul>


<p>Asynchronous discussion happens in the mailing list. #static irc channel is the place for interactive discussion.</p>

<p><strong>Nearterm Plans For Plugins </strong></p>

<p>GCC 4.5 has an official plugin framework enabled by default. I will try to switch to GCC 4.5 as soon as it is out. Currently 4.5 is still changing too often for me to bother fixing Treehydra (Dehydra usually works). As soon as 4.5 is out I will revise the installation instructions to use distribution GCC and JavaScript packages to avoid the current mess (draft can be found <a href="http://groups.google.com/group/mozilla.dev.static-analysis/browse_thread/thread/a773ebdbc5479f9a#">here</a>). Sometime after that I&#8217;ll switch Mozilla static analysis to GCC 4.5 and drop 4.3 support.</p>

<p>Hopefully, this will make it easier for other open source projects to adapt the hydras.</p>

<p><strong>Plans for Analyses</strong></p>

<p>I&#8217;m a big believer into application-specific static analyses, but I would like to see some heavy duty open source analyzers built on top of GCC.</p>

<p>Some of the not-so-Mozilla-specific analyses should be bundled together to make them easy to try out on other projects.</p>

<p>Hopefully 2010 will be the year that open source static analysis catches on.</p>

<p><strong>LCA2010</strong></p>

<p>I posted my <a href="http://people.mozilla.com/~tglek/lca2010/">slides</a> from yesterday.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/19/chromium-vs-minefield-cold-startup-performance-comparison/">Chromium vs Minefield: Cold Startup Performance Comparison</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-19T09:05:28-08:00" pubdate data-updated="true">Jan 19<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>Hunting Down Mythical &#8220;Slowness&#8221;</strong></p>

<p>I recently met a developer who used Chromium instead of Firefox. Chromium&#8217;s superior startup speed was his reason for using it.This got me excited because said developer was running Linux, so it was relatively easy to measure cold startup and get a complete <a href="http://taras.glek.net/blog/2009/10/23/studying-library-io-systemtap-style/">IO breakdown</a>.</p>

<p>Turned out Firefox took roughly 23 seconds to start. After much cursing about how I&#8217;ve never seen Firefox startup this slow, I eventually gave up on figuring out what&#8217;s slowing his startup and instead we measured Chromium startup. It also turned out to also be roughly 23 seconds. The super-slow hard drive made everything slow. Turned out Chromium&#8217;s superior startup was a myth in this case.</p>

<p><strong>Measuring Startup</strong></p>

<p>As a result of investigating the startup myth above, my kiwi coworkers encouraged me to post a comparison of Chrome/Firefox startup. I am at <a href="http://www.lca2010.org.nz/">linuxconf</a> at the moment so I did the comparison on my laptop.</p>

<p>Laptop configuration:</p>

<ul>
<li>Intel(R) Core(TM)2 Duo CPU  L9400 running at 800Mhz to amplify any performance differences.</li>
<li>HITACHI HTS722020K9SA00 harddrive for the user profile and browser binaries</li>
<li>OCZ Vertex 30GB SSD for system libraries/configuration.</li>
<li>Fedora 12, Minefield 20100119 tarball, chromium-4.0.285.0-0.1.20091230svn35370.fc12.i686</li>
<li>sudo sync &amp;&amp; sudo sysctl -w vm.drop_caches=3 &amp;&amp; sudo sysctl -w vm.drop_caches=0 to clear the disk cache inbetween runs
What am I testing? I am measuring the time between invoking the browser until a JavaScript snippet embedded within a basic webpage is executed (ie <a href="http://blog.vlad1.com/2009/07/28/measuring-startup/">Vlad&#8217;s approach</a>, with a slightly modified <a href="http://people.mozilla.com/~tglek/startup/startup.html">startup.html</a>). The above sysctl command clears disk caches, this creates a similar situation to when one turns on the computer and it hasn&#8217;t yet loaded all of the browser libraries from disk into memory. This is a blackbox approach to measuring how long it takes from clicking on the browser icon to get an interactive browser.</li>
</ul>


<p>Firefox commandline: firefox -profile /mnt/startup/profile/firefox  -no-remote file://<code>pwd</code>/startup.html#<code>python -c 'import time; print int(time.time() * 1000);'</code></p>

<p>Chromium commandline: chromium-browser &#8211;user-data-dir=/mnt/startup/profile/chrome  file://<code>pwd</code>/startup.html#<code>python -c 'import time; print int(time.time() * 1000);'</code></p>

<p>Both of these tests are done with an empty profile that was populated and has settled after running the browser a few times.</p>

<p><strong>Results</strong></p>

<p>The following numbers are milliseconds reported by the startup.html above.</p>

<p>Running Chromium five times: 4685, 4168, 4222, 4197, 4232</p>

<p>Running Minefield five times: 3155, 3273, 3352, 3311, 3322</p>

<p>I picked Minefield because that&#8217;s the browser that I run and the codebase that I focus on. The linux Chromium channel seems to be the closest parallel to Minefield. I did not test on Windows because it is a bit of a <a href="http://taras.glek.net/blog/2010/01/04/windows-7-startup-exploration/">nightmare</a> to measure cold startup there.</p>

<p><strong>Conclusion</strong></p>

<p>On my system Minefield is around 30% faster at starting up with  an empty profile than Chromium (the difference is amplified by running the CPU at 800Mhz). For comparison of Minefield against older Firefox versions, see <a href="http://autonome.wordpress.com/2009/11/21/firefox-startup-performance-weekly-summary-11/">Dietrich&#8217;s post</a>.</p>

<p>I suspect that there is a relatively small difference between the two browsers because we are running into the fundamental limitations of loading large applications into memory (<a href="http://taras.glek.net/blog/2009/10/20/large-apps-just-have-to-start-slow/">my rant</a>).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/04/some-developers-manually-grope-around-in-the-dark/">Some Developers Manually Grope Around in the Dark</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-04T12:27:03-08:00" pubdate data-updated="true">Jan 4<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Cool thing about static analysis is that you can ask painful-for-humans questions about your codebase AND have them answered. Here are two that got answered by Ehren:</p>

<p>Where do function bodies continue after return statements (ie obviously dead/broken code)? <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=535646">Bug 535646</a>.</p>

<p>How many functions in Mozilla could/should be marked static? <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=536427">Bug 536427</a>.</p>

<p>Awesome!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/04/windows-7-startup-exploration/">Windows 7 Startup Exploration</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-04T03:28:49-08:00" pubdate data-updated="true">Jan 4<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I did some digging to figure out if one can setup cold-startup testing in Windows 7 without nasty hacks. My conclusion is: sorta-kinda.</p>

<p><strong>The Good - Most of the Ingredients Are Present </strong></p>

<p>I haven&#8217;t actively used Windows since pre-XP days. It looks like it has come a long way since then: there is now a decent interactive shell, all kinds of settings/services can be controlled from the commandline and there is even sudo-like functionality.</p>

<p>PowerShell takes inspiration from the korn shell and throws in .net which allows for much nicer &#8220;shell programming&#8221; than the dominant bash shell.</p>

<p>mountvol is a terrible equivalent to mount in linux - but it exists, so I&#8217;m happy.</p>

<p>NTFS junctions are frustrating equivalents to links in a unix filesystem.</p>

<p><strong>The Bad</strong></p>

<p>The essential ability to completely flush filesystem caches isn&#8217;t there. This isn&#8217;t quite as embarrassing as it seems as Mac OS X&#8217;s purge command does not flush the page cache (resulting in mmapped files not purged from cache), so technically OS X has the same limitation and only Linux gets it right.</p>

<p><strong>The Ugly Workaround</strong></p>

<p>After much brainstorming we figured out that we can clear all relevant caches on Mac OS X by putting files that we care about on a separate partition and mounting/unmounting it for every measurement.</p>

<p>Ridiculously, Windows is &#8220;smarter&#8221; than that and appears to cache stuff per-drive, such that mounting/unmounting a partition has no effect on the cache. The best workaround I could come up with involves putting the said partition onto a USB disk and unplugging it in-between unmount/mount testing cycle.</p>

<p><strong>Windows 7 Startup Recipe</strong></p>

<p>1) Set up junctions for the 2 profile directories to point to the USB partition, unzip firefox onto that partition.</p>

<p>2)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$old = (get-location)
</span><span class='line'>$mountpoint = $env:userprofile + "\cold"
</span><span class='line'># magic name given by running mountvol
</span><span class='line'>$drive = "\\?\Volume{885d5bc3-e918-11de-a4e5-002268e3077c}\"
</span><span class='line'># Based on http://poshcode.org/696 + fiddling with UAC settings to avoid prompts
</span><span class='line'>sudo mountvol $mountpoint $drive
</span><span class='line'># Mountvol doesn't seem to block until drive is mounted
</span><span class='line'>sleep 1
</span><span class='line'>#mountvol
</span><span class='line'>cd $mountpoint\firefox
</span><span class='line'>echo (pwd)
</span><span class='line'># The following command shows PowerShell awesomeness
</span><span class='line'># based on [Vlad's approach](http://blog.vlad1.com/2009/07/28/measuring-startup/)
</span><span class='line'>./firefox.exe -no-remote "file://$(pwd)\startup.html#$([Int64](([DateTime]::utcnow - (new-object DateTime 1970,1,1)).ticks/10000))"
</span><span class='line'>cd $old
</span><span class='line'># I haven't yet figured out how to wait on firefox.exe to finish
</span><span class='line'>sleep 10
</span><span class='line'>sudo mountvol $mountpoint /d</span></code></pre></td></tr></table></div></figure>


<p>3) Unplug USB drive</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/17/javascript-dom/">JavaScript DOM</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-17T07:43:01-08:00" pubdate data-updated="true">Dec 17<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I filed<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=533874"> bug 533874</a> to expose the JavaScript AST to JS, but turns out I need to explain why it&#8217;s important to expose the JavaScript AST. So lets start from the beginning.</p>

<p>My name is Taras and I like to wrestle useful information out of tools that do not think to offer it. I firmly believe that writing/maintaining code is more difficult than it should be. I think the current organization of compilers is partially responsible for it.</p>

<p><strong>Related Prior Work </strong>Some groups at Mozilla have realized that inspection and refactoring of code are tasks that will often consume as many people as can be thrown at it so there has to be a better way. That better way is through tools: get computers to do things that are difficult for humans. We do that a lot for other kinds of tasks, but not so much for computers. For example, when was the last something you googled something using telnet? Yet our tools for presenting and analyzing code are about as sophisticated as telnet. For some reason it is easier to find some random piece of information on the web than it is to find what code implements a function that is being called from my code.</p>

<p>As the original author, I think <a href="https://developer.mozilla.org/En/Dehydra">Dehydra</a>, <a href="https://developer.mozilla.org/en/Treehydra">Treehydra</a> on top of the GCC plugin <a href="http://gcc.gnu.org/wiki/GCC_PluginAPI">API</a> give us a pretty reasonable way to extract useful information out of our C++ code. I feel lost and confused without Dave&#8217;s <a href="http://australia.proximity.on.ca/dxr/">DXR</a>, the JS team routinely breaks (and fixes) invariants in the JS engine and we&#8217;ve been able to wipe out certain classes of bugs (ie code patterns that cause them) mozilla-wide. I&#8217;m looking forward to reducing the footprint of Mozilla by deleting <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=457262">more</a> dead code.</p>

<p><strong>JavaScript Needs</strong> My efforts so far have focused on C++ because it is finicky language and developers need all the help they can get with it. I think we need to the same thing for JavaScript. I think there is a lot of useful information in JavaScript code that is burried and hard to get to. <a href="http://quetzalcoatal.blogspot.com/">Joshua Cranmer</a> broke new ground in building <a href="https://developer.mozilla.org/en/JSHydra">JSHydra</a> on top of SpiderMonkey. This way one can parse JavaScript in exact same way as Spidermonkey sees it (something that can only be approximated with other approaches). I think we should offer the ability to analyze js code within Spidermonkey. Unfortunately, he is a busy student so he doesn&#8217;t have the time to develop JSHydra this to the next level. <strong> How Would JavaScript Developers Benefit?</strong> Currently we have jshydra deployed on AMO to scan javascript for potential issues to make the reviewer&#8217;s job more productive. Dave Humphrey is working away on integrating JSHydra into DXR so we can have semantic navigation of JavaScript: what components are implemented JavaScript, wouldn&#8217;t it be nice to know who calls certain methods(including javascript callsites), etc. Gandalf has a cool idea where he needs to be able to extract translatable strings out of JetPacks. I believe JetPack people in general would like to be able to analyze JS code more.</p>

<p>I think it&#8217;s clear that the common trend in all these tasks is to turn an opaque text blob into something that can be easily navigated programatically. Wouldn&#8217;t it suck to not to be able to walk the DOM for HTML? Why is it ok to accept that handicap for the essense of all programs?</p>

<p><strong>How Should This Be Solved?</strong> I don&#8217;t know for sure, but my friend Jim Blandy, came up with a good suggestion. We already have eval/uneval in SpiderMonkey. it would be really cool to extend uneval to produce a iteratable data structure instead of a text blob. So I filed a <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=533874">bug 533874</a> on this, and this my explanation of why I think that would be a very empowering feature to expose ASTs in JavaScript.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/03/rooter-hardware/">Rooter Hardware</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-03T03:11:00-08:00" pubdate data-updated="true">Dec 3<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Rooter - British pronunciation of router. This is post describes the hardware in my Atom router.<br /><br />I wanted a low power x86 router. There a number of things that I want to be able to do with it on my lan: DNS for naming/tracking a few dozen devices, VOIP, media serving with MPD + PulseAudio.<br /><br />I choose Atom because it is cheap to buy and to run. CPU/Mobo combos start at $50. There are two flavours of Atom boards: cheap ones with desktop chipsets and more expensive ones with laptop chipsets (which consume 50% less power).  I also needed to have 2 nics and to have gigE on the LAN side. Most boards ship with RealTek NICs which have absolutely terrible drivers. Unfortunately there is only one (<a href="http://www.tweaktown.com/reviews/1675/msi_im_945gse_a_mini_itx_fanless_atom_motherboard/index2.html">MSI IM-955GSE-A</a>) massmarket dual Intel-gigE board that doesn&#8217;t suck and it costs $150. <br /><br />Due to a misleading ebay listing I ended up buying MSI IM-955GSE-B on Ebay. It is the former boards&#8217; wierdo industrial sibling(no VGA, 1 gigE, but 6 serial ports!). It features a builtin DC2DC power supply which connects via a floppy-power-connector to a 12V DC source.<br /><br />To make up for a missing Ethernet port I opted for a USB2.0 100Mbit nic (Trendnet TU2-ET100,which uses the &#8216;asix&#8217; driver). This NIC is a true full-speed device and easily sustains 11MB/s transfers, so it&#8217;s perfectly good enough for a WAN port.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://ep.yimg.com/ca/I/yhst-27518546784426_2079_116848138" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://ep.yimg.com/ca/I/yhst-27518546784426_2079_116848138" /></a><br /></div>I got the cheapest Mini-ITX case on ebay. It came with a great 65W Seasonic power supply.<br /><br />Cost:<br />Case - $30<br />Mobo/CPU - $82<br />2GB RAM - $30<br />USB NIC - $18<br />Total: $160 <br /><br />I installed Fedora onto a spare 4gb usb stick. I am really happy with the resulting computer. It is very quiet because it has no moving fans.<br /><br /><b>PSU Hack</b> <br />Current 13W idle power draw is reasonable given that the PSU is likely underloaded and thus less efficient .<br />Currently, the mobo is powered by shorting the ON pins on the PSU(+ducttape for robustness) and a custom Molex2Berg adapter cable(made for me by a very resourceful friend). Eventually I plan to switch over the EEE power supplies as they are better specced for such low power motherboards. This would also avoid redundant dc2dc conversion going on in the case.<br /><br /><b>Power-On AC</b><br />I considered using busted netbook for rooter duties but laptops do not usually have the Power-On-AC option (or power-on-lan-activity). With power-on-ac Rooter turns On/Off just like any other appliance when one messes with the power cord. That&#8217;s as wife-safe as a computer can get :)</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/15/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/13/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/10/snappy-number-48-now-with-faster-shutdown/">Snappy #48: Now With Faster Shutdown</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/04/snappy-2012-summary/">Snappy: 2012 Summary</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/24/making-pages-load-faster/">Making pages load faster</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/21/interesting-bugzilla-activity/">Snappy #45: The view from home</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/17/hello-octopress/">Hello Octopress</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
<script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>

  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("tarasglek", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tarasglek" class="twitter-follow-button" data-show-count="false">Follow @tarasglek</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p><h6>
  Copyright &copy; 2013 - Taras Glek - content on this site is licensed under the
Creative Commons Attribution Share-Alike License v3.0 or any later version.

  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span></h6>
</p>
<script>
//indicate that content has been loaded
window._monitorContentLoaded = Date.now()
</script>
<script src="http://monitor-taras-glek-net.appspot.com/static/monitor.js">
</script>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'allaboutperformance-tarasglek';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
