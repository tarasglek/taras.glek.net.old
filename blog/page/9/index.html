
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>All About Performance</title>
  <meta name="author" content="Taras Glek">

  
  <meta name="description" content="Linux Plumbers A few of us attend LinuxPlumbers last month, I gave talk. Basic summary: kernel + toolchain could add a few straight-forward features &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://taras.glek.net/blog/page/9/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="All About Performance" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" title="subscribe via RSS">All RSS</a></li>
  
  <li><a href="/mozilla.xml" title="subscribe via RSS">Mozilla RSS</a></li>
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

<script>
if (!window.requestAnimationFrame) {
  window.requestAnimationFrame = window.mozRequestAnimationFrame
    || window.webkitRequestAnimationFrame
    || window.msRequestAnimationFrame;

  window.cancelAnimationFrame = window.mozCancelAnimationFrame
    || window.webkitCancelAnimationFrame
    || window.msCancelAnimationFrame;

}

function refreshLogCounter() {
  if(!window._refreshLog) {
    window._refreshLog = [Date.now()]
    return
  }
  window._refreshLog.push(Date.now()-window._refreshLog[window._refreshLog.length-1].now())
  window._refreshLogCounter = requestAnimationFrame(refreshLogCounter);
}

window._refreshLogCounter = requestAnimationFrame(refreshLogCounter);

</script>

</nav>
  <header role="banner"><hgroup>
  <h1><a href="/">All About Performance</a></h1>
  
    <h2>and other stuff by Taras Glek</h2>
  
</hgroup>

</header>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/10/misc/">Misc</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-10T08:28:14-07:00" pubdate data-updated="true">Oct 10<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>Linux Plumbers</strong></p>

<p>A few of us attend LinuxPlumbers last month, I gave <a href="http://people.mozilla.com/~tglek/lpc2011/">talk</a>. Basic summary: kernel + toolchain could add a few straight-forward features to make Firefox and other apps start faster and use less memory.</p>

<p><strong>Performance Team</strong></p>

<p>I am no longer alone on my quest of performance whack-a-mole. Since spring I&#8217;ve been growing a team of extremely talented people to help make Firefox faster and slimmer. As a manager I do more people tasks now, so I have less &#8221; ____ sucks&#8221; blog posts to write. We are currently working on massively speeding up Fennec startup via <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=686805">incremental decompression</a> (sort of like an efficient UPX for android), fixing SQLite + other IO <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=611837">usage</a> in Firefox, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=662397">reordering binaries</a> for faster startup, faster <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=662444">shutdown</a>. The idea is to focus on all areas of browser performance other than rendering the web (for now).</p>

<p><strong>Performance Help</strong></p>

<p>&#8220;Perf work is cool, but I wouldn&#8217;t know where to start with finding a good first perf-bug&#8221; &lt;&#8211; is this you? Would any of my readers be interested in a roundup of next set of &#8220;low hanging fruit&#8221; perf-improvements to be had?</p>

<p>Example bugs:</p>

<ul>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=693485">Implement </a>readahead support on Android</li>
<li>Use <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=613124#c1">readahead</a> for omnijars</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/20/firefox-7-telemetry-faster-startup/">Firefox 7: Telemetry</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-20T07:59:43-07:00" pubdate data-updated="true">Sep 20<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>****Firefox 7 marks a turning point in how we measure Firefox performance. Traditionally we measured Firefox performance on individual developer machines and our build &amp; release infrastructure. However it turns out synthetic benchmarks do not correspond to real-world Firefox usage: it is difficult to model a &#8220;typical&#8221; computer in a lab environment. Surprisingly slow consumer hardware, changes in usage patterns, preinstalled bloatware all affect Firefox performance in surprising ways.</p>

<p>Firefox 7 telemetry will prompt users to opt-in to reporting performance data to Mozilla. This data will supplement our existing benchmarking infrastructure to help us optimize future Firefox releases. Telemetry performance metrics are very lightweight and will not negatively impact Firefox performance.</p>

<p>In addition to transmitting data via SSL, Mozilla privacy team worked tirelessly to ensure that no personally-identifiable information is sent via telemetry. Whereas many other software projects stamp this kind of data with a unique per-user id, we opted for a per-session id which is reset every time the browser restarts. Telemetry is also disabled while in private-browsing mode.</p>

<p>The following telemetry data will be gathered in Firefox 7:</p>

<ul>
<li>Memory usage</li>
<li>CPU core count</li>
<li>Cycle collection times</li>
<li>Startup speed
Use the <a href="https://addons.mozilla.org/en-US/firefox/addon/abouttelemetry/">about:telemetry</a> extension to check on your browser performance. The following screenshot shows how to enable telemetry:</li>
</ul>


<p><img src="http://people.mozilla.com/~tglek/telemetry/telemetry-ff7.jpg" alt="" /></p>

<p>I&#8217;m very excited that Firefox finally joins the ranks of cars, airplanes and other software projects in making performance decisions based on real evidence gathered in the wild.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/20/firefox-7-cheating-the-operating-system-to-start-faster/">Firefox 7: Cheating the Operating System to Start Faster</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-20T07:54:07-07:00" pubdate data-updated="true">Sep 20<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>****Firefox 7 features improved startup speed. Our research has shown that most OSes are not capable of starting large programs efficiently (see my older blog entries). As a result, Firefox 7 will explicitly tell the OS to aggressively preload our xul.dll/libxul.so/XUL library before passing it on to the runtime linker. This marks the productization of the approach explored in &#8220;20-line patch that doubles Firefox startup&#8221; that got people so excited. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=552864">bug 552864</a> and dependent bugs for exciting technical details.</p>

<p><strong>Do Not Try this at Home: Ugly Windows</strong></p>

<p><em>Note: Windows Prefetch does everything possible to thwart exciting startup optimizations.</em> Above optimization only works when prefetch is disabled/broken (ie Firefox should be faster with Windows Prefetch off). See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=627591#c158">this comment</a> on disabling prefetch for Firefox. Alternatively one may get Windows Prefetch to not slow down Firefox startup by the following magic incantation:</p>

<ol>
<li>Install Firefox (or delete the windows prefetch entry for existing Firefox 7)</li>
<li>Reboot (Do not start Firefox after installation!)</li>
<li>Start Firefox.
Above helps populate the Windows Prefetch in a less counter-productive way. Explanation: on warm startup Windows Prefetch records irrelevant IO operations and blocks Firefox startup to preload files that Firefox accesses <em>after</em> startup.</li>
</ol>


<p>Note: the <a href="http://mxr.mozilla.org/mozilla-central/source/browser/app/nsBrowserApp.cpp#224">heuristic</a> that we use to detect Windows Prefetch will also prevent this optimization from kicking in on some exceptionally slow hard drives when prefetch is off. This is unfortunate as this optimization is most dramatic on exceptionally slow machines.</p>

<p>According to our preliminary telemetry data, less than 25% of our Windows users have Windows Prefetch off and can benefit from vastly improved startup. We expect to improve this in future Firefox releases by scheduling a prefetch cleanup operation similar to the script in above bugzilla comment.</p>

<p>Operating systems without counter-productive startup heuristics (ie Mac/Linux) will simply allow Firefox 7 to start faster.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/09/ride-to-the-coast/">Ride to the Coast</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-09T14:45:55-07:00" pubdate data-updated="true">Aug 9<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I like having guests who bike. So when Brian came over I decided this would be a great opportunity to explore going to the coast and back by bike (<a href="http://velodirt.com">velodirt</a> style). The following is a map of our trip (190miles, 2 nights).</p>

<p><a href="http://taras.glek.net/blog/files/2011/08/map.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/bike.jpg" alt="" /></a></p>

<p>The gravel roads were somewhat challenging. It was hard to climb in the heat so at times we had to push our bikes.</p>

<p><a href="/assets/images/2011-08-09-ride-to-the-coast/push_small.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/push_small.jpg" alt="" /></a></p>

<p>Things got more unpleasant when we encountered loose gravel by Tillamook which sent Brian sliding over the edge :(</p>

<p><a href="/assets/images/2011-08-09-ride-to-the-coast/205869_704363319326_122500004_37237117_241562_n.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/205869_704363319326_122500004_37237117_241562_n.jpg" alt="" /></a></p>

<p>Amazingly he got off without a single scratch (type-inference will go on!).</p>

<p>Eventually we got to <a href="http://www.oregonstateparks.org/park_186.php">Cape Lookout</a>.</p>

<p><a href="/assets/images/2011-08-09-ride-to-the-coast/beach1_small.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/beach1_small.jpg" alt="" /></a></p>

<p>The next day we biked to and spent the night in <a href="http://www.oregonstateparks.org/park_201.php">Nehalem Bay</a>.</p>

<p><a href="/assets/images/2011-08-09-ride-to-the-coast/beach2_small.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/beach2_small.jpg" alt="" /></a></p>

<p>Then it was time to head back :(</p>

<p>On the way back we did some more gravel roads, this time they were really nice. The road took us through a berry-laden forest and rewarded us with some pretty awesome views.</p>

<p><a href="/assets/images/2011-08-09-ride-to-the-coast/brian_far.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/brian_far.jpg" alt="" /></a></p>

<p><em>(If you squint you can see Brian)</em></p>

<p><a href="/assets/images/2011-08-09-ride-to-the-coast/view1_small.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/view1_small.jpg" alt="" /></a></p>

<p>The thing to keep in mind about gravel roads is that they like to get out of sync with the maps. We had to reroute due to roads going in a different direction, and due to various kinds of deadends.</p>

<p>In one extreme case a road was clearly on the map, but had a &#8220;DEAD END&#8221; sign on it. Which got us thinking &#8220;is this a dead end for cars or is it for real?&#8221;. After some climbing, the gravel road reduced to a nice forest path.</p>

<p><a href="/assets/images/2011-08-09-ride-to-the-coast/dead1_small.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/dead1_small.jpg" alt="" /></a></p>

<p>Further on it became obvious that someone tried hard to kill this road. Some road hater put up over a dozen tree pile barriers, with some reaching my height.</p>

<p><a href="/assets/images/2011-08-09-ride-to-the-coast/piles.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/piles.jpg" alt="" /></a></p>

<p>Turned out the road did indeed go through. Perhaps some day someone will start a cyclocross race dedicated to bringing this road back :)</p>

<p>The last highlight of the trip was this delicious-looking buffalo herd.</p>

<p><a href="/assets/images/2011-08-09-ride-to-the-coast/buffalo.jpg"><img src="/assets/images/2011-08-09-ride-to-the-coast/buffalo.jpg" alt="" /></a></p>

<p>I love cycling in Oregon.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/03/effective-static-analysis/">Effective Static Analysis</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-03T13:27:54-07:00" pubdate data-updated="true">Aug 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Static analysis can be a very fun pastime. One gets to sift through giant codebases looking for interesting clues, what could be more fun? A couple things qualify: a) static analysis accompanied by cool rewrites b) static analysis accompanied by cool visualizations.</p>

<p><strong>Cool Rewrite</strong></p>

<p>Michael Wu&#8217;s <a href="http://blog.mozilla.org/mwu/2011/07/28/the-twelve-booleans-of-mozilla/">boolcheck</a> tool is awesome. He wrote it to check that &#8220;typedef int&#8221; bools are really being used as booleans and aren&#8217;t perversely carrying integer values. The process of writing the tool is cool. As Michael is discovers bugs/disagreements stemming from setting &#8220;typedef bool PRBool&#8221;, he just adds another pattern to check for to the tool and never has to worry about that pattern again. I hope to see someone apply boolcheck to the linux kernel, GTK projects or anything else with int booleans. Some projects don&#8217;t have the luxury of switching to real bools, so they can continue using a static checker to make up for it.</p>

<p><strong>Pretty Code</strong></p>

<p>I&#8217;ve blogged about <a href="http://dxr.mozilla.org/clang/">DXR</a> many times. As of this week clang-based DXR is on par with the old Dehydra-based one. Callgraph, inheritance, etc queries now work. <a href="http://quetzalcoatal.blogspot.com/">Joshua</a> did an outstanding job gutting and rewriting the DXR backend this summer and is now going back to school. I&#8217;m extremely impressed with his work this summer. I didn&#8217;t think it was possible to get as far as he did.</p>

<p>We are looking for more help with DXR. Please deploy it on your pet project, contribute plugins for various languages, simplify deployment, etc.</p>

<p>Additionally, now that the backed is in a fairly decent shape, we are looking for someone to help us turn DXR into the slickest code browsing tool ever(we have some ideas <a href="https://wiki.mozilla.org/DXR_Future_Work_Plan">written down</a>). I&#8217;d like interactive graphs, various code visualizations, integration with bugzilla, etc. This needs a JSON-query frontend and a few other bits &amp; pieces to be implemented.</p>

<p><strong>Interns Wanted</strong></p>

<p>We would love to hire more static analysis interns. Are you student who dreams about making large codebases easy to grasp? Do you want to spend a few months making Control Flow Graphs behave? If that sounds like your calling: leave a comment, send me an email.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/07/16/my-nas-is-smaller-than-yours/">My NAS Is Smaller Than Yours</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-16T19:29:00-07:00" pubdate data-updated="true">Jul 16<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-NyjNccrtMm4/ThfcarpyIvI/AAAAAAAABT4/gYYcP66XgE8/s1600/IMGP4287.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="http://2.bp.blogspot.com/-NyjNccrtMm4/ThfcarpyIvI/AAAAAAAABT4/gYYcP66XgE8/s640/IMGP4287.JPG" width="424" /></a></div>&nbsp;I once <a href="/blog/2009/11/from-arms-and-mips.html">blogged</a> that ARM devices are useless and how one shouldn&#8217;t buy them cos they run weird forked kernels on weird bootloaders. I also blogged on how awesome and low power my <a href="/blog/2009/12/rooter-hardware.html">Atom box</a> was.<br /><br />Since then my Atom box died (probably the power supply), so faced with the option of rebuying various components until I find one that broke I decided that I&#8217;d rather forgo that. Instead I got an $40 Seagate Goflex.<br /><br />The atom box idled at 13W and maxed out around 20W, which was pretty impressive. Goflex can idle at 4W and maxes out at 7W. The 1ghz CPU is no x86 in speed, but it can keep up.<br /><br />Clever people developed a fully-featured Uboot bootloader for it so it takes care of that typical non-x86 suck. I opted to run  <a href="http://archlinuxarm.org/platforms/armv5/seagate-goflex-net">arch linux for arm</a> since Debian support isn&#8217;t particularly mature. In some ways Arch is better, it doesn&#8217;t play games with proprietary firmware and stays up to date better.<br /><br />So yeah with a $40 pricepoint, dual native sata, 4W idle even I will run ARM :)<br /><br /><i>Bonus:</i> In theory I should be able to run the static binaries I compile on the goflex on my android phones.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/07/01/telemetry-status/">Telemetry Status</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-01T04:48:33-07:00" pubdate data-updated="true">Jul 1<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>Telemetry Present</strong></p>

<p>Telemetry infrastructure has only been deployed for week, but we are already gathering interesting data<em>:</em></p>

<ul>
<li><em>Memory usage </em>from about:memory gives us an idea of what constitutes typical memory usage for Firefox</li>
<li><em>Cycle-collection overhead, stats</em> tell us about browser pauses due to memory cleanup</li>
<li><em>Detailed startup profiling</em> tells us whether our new <a href="http://glandium.org/blog/?p=2105">library preloading logic</a> is effective</li>
<li>Info on whether the browser was <em>shutdown</em> correctly will help us diagnose shutdown problems</li>
<li><em>Plugin enumeration timing</em> to make sure my <a href="http://taras.glek.net/blog/2010/12/29/faster-plugin-enumeration-help-wanted/">faster plugin enumeration</a> stays fast</li>
<li><em>HTTP connection profiling</em> to help optimize page loads
Since the branch point for Aurora is approaching in less than a week, I don&#8217;t expect many more probes for Firefox 7.</li>
</ul>


<p><strong>Telemetry Future</strong></p>

<p>One problem with doing awesome optimizations that as code changes, they frequently get accidentally undone. I plan to add telemetry to keep tabs on every significant optimization that I do in the future, in addition to retroactively adding it to the past ones. I expect other Mozilla developers to do the same. In addition to keeping tabs on Firefox performance, we can also learn about JavaScript feature adoption, the kind of hardware (and OS) that users run Firefox on, etc to better match users&#8217; needs.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/30/dehyratreehydra-static-analysis-thoughts/">Dehyra/Treehydra Static Analysis Thoughts</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-30T05:07:20-07:00" pubdate data-updated="true">Jun 30<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was pleased to see Mozilla static analysis <a href="http://lwn.net/Articles/447916/">mentioned</a> on lwn. Yes indeed, the <a href="https://lists.mozilla.org/listinfo/dev-static-analysis">mailing list</a> has been pretty dead (most of our communication happens on irc.mozilla.org #static). I completely failed to build a community around my static analysis tools. Perhaps more people will try <a href="https://developer.mozilla.org/en/Dehydra">Dehydra</a> now that it&#8217;s <a href="http://packages.debian.org/experimental/dehydra">getting</a> into Debian. The hydras are still alive, <a href="http://hg.mozilla.org/rewriting-and-analysis/dehydra/">evidence</a> can be seen in the mercurial commit log. Development has slowed because the hydras are now considered to be feature-complete and my primary focus is elsewhere in Mozilla now.</p>

<p>As to why open source static analysis has failed to take off, I have a few theories. I think the main problem is that static analysis requires a compiler/correctness/type-system-nerd/large-scale-development-nerd type personality. That&#8217;s a pretty rare intersection of hobbies to begin with. One also has to hate the <a href="http://people.mozilla.com/~tglek/lca2010/">stone age</a> that C/C++ ecosystem we are in, but not move on to shiny new Haskell/Ocaml/whatever communities.</p>

<p><strong>Have I failed at igniting the static analysis revolution?</strong></p>

<ol>
<li>My goal primary goal was: provide a way to analyze Mozilla source code to speed up our development + refactoring efforts.</li>
<li>My secondary goal was to make sure that whatever work I do, nobody else has to suffer through the unbelievably sucky infrastructure cruft I had to work through.</li>
<li>Lastly, I did put in some effort at promoting open source static analysis (by giving talks at conferences, etc) since working in an active community is more fun.
<em>Mozilla side</em>:</li>
</ol>


<p>I&#8217;m happy to report that I achieved a culture shift at Mozilla. Instead of people saying &#8220;oh god, I can&#8217;t find all instances of ___ issue in 3million lines of C++ code&#8221;, it&#8217;s pretty common to hear &#8220;lets solve this through static analysis&#8221;. Dehydra was designed to take the bitchwork (boilerplate of compiler integration, etc) out of static analysis so one can focus on the analysis part. New Dehydra users within Mozilla seem to confirm that. Instead of pondering whether certain tool-assisted refactorings are feasible, we plan to embark on some now (turned out we were understaffed to keep up with tool output and overburdened by api compatibility before; more on this in a future blog post).</p>

<p><em>No More Static Analysis Bitchwork:</em></p>

<p>The worst aspect of dealing with C++ is parsing it. The second worst aspect is dealing with the preprocessor. With respect to parsing C++ we went from weirdo-custom-frontends(ie Elsa, EDG, etc) and &#8220;GCC will never allow plugins, don&#8217;t waste your time&#8221; to GCC adopting a plugin architecture that suited my static analysis needs. I also implemented source-location transformation tracking(-K) in <a href="http://mcpp.sourceforge.net/">mcpp</a>, so nobody has to suffer through undoing braindamage inflicted by the C proprocessor again. I hear at least a couple of people benefited from MCPP work and I take partial credit for every new analysis GCC plugin. I suspect I saved a few person-months for somebody :)</p>

<p>Btw, I think Chris Lattner&#8217;s from-scratch effort on <a href="http://clang.llvm.org/">Clang</a> is way awesomer than anything I could ever accomplish.</p>

<p><em>Conferences &amp; Stuff:</em></p>

<p>I admit complete and utter failure in this regard. Most open source people have low regard for static analysis. Linus seems to take a million-monkeys-with-type-writers approach (ala the open source eyeballs approach to security) to ensuring kernel code quality (which is a reasonable approach when you have mobs of contributors). Most other projects do not have the resources to spare on unproven tech such as static analysis.</p>

<p>To make matters worse, at first people thought JavaScript was a toy language worth only cut&#8217;n&#8217;pasting from recipes online. Then just as JavaScript was getting more popular, SpiderMonkey embedding got buggier and made for some unpleasant first experiences with the Hydras.</p>

<p><strong>Conclusion</strong></p>

<p>There isn&#8217;t much to show for my work outside of Mozilla; that&#8217;s fine since my primary goal was Mozilla :) The Hydras aren&#8217;t dead, they are in maintenance mode.</p>

<p>I&#8217;m glad to see <a href="http://lwn.net/Articles/448698/">python-as-gcc-plugin </a>approach, it seems to fill the same niche as <a href="https://developer.mozilla.org/en/Treehydra">Treehydra</a>. I regret not starting out with Python (I think it&#8217;s slightly better than JavaScript for this task), I hope David Malcolm succeeds in attracting wider interest.</p>

<p>PS. I&#8217;m super-excited about the new <a href="http://quetzalcoatal.blogspot.com/2011/06/alpha-release-of-dxr.html">DXR work</a>. <a href="http://dxr.mozilla.org/">DXR</a> is something that makes my daily life easier. DXR is by far the smartest code-indexing system out there, it&#8217;s bound to transform my life as a developer far more than any static analysis ever could :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/27/telemetry-is-on-in-nightly-firefox-builds/">Telemetry Is on in Nightly Firefox Builds</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-27T04:26:12-07:00" pubdate data-updated="true">Jun 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Telemetry went live in Firefox Nightly builds over the weekend. Everyone who wants to contribute to making Firefox better now has an easy new way: opt-in to telemetry. There are two ways to opt in: A) Click yes when prompted to report performance B) Enable it by going to Options/Preferences, then Advanced/General tab</p>

<p><a href="/assets/images/2011-06-27-telemetry-is-on-in-nightly-firefox-builds/Optimized-out.jpg"><img src="/assets/images/2011-06-27-telemetry-is-on-in-nightly-firefox-builds/Optimized-out.jpg" alt="" /></a></p>

<p>You can check on the data collected by installing my <a href="https://addons.mozilla.org/en-US/firefox/addon/abouttelemetry/">about:telemetry</a> extension.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/22/developers-how-to-submit-telemetry-data/">Developers: How to Submit Telemetry Data</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-22T07:06:14-07:00" pubdate data-updated="true">Jun 22<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Telemetry is a way to gather stats about Firefox. Currently histograms are the main mechanism by which to gather data. There are 3 histogram types currently supported: exponential, linear and boolean. Exponential+linear histograms can accumulate numbers between 0 and a user-defined integer maximum, they differ in bucket size increments. Boolean histograms are meant to store 0 or 1.</p>

<p><strong>Steps to Add a New Metric</strong></p>

<p>1) Add a histogram definition to <a href="http://mxr.mozilla.org/mozilla-central/source/toolkit/components/telemetry/TelemetryHistograms.h">TelemetryHistograms.h</a> specifying a histogram id, parameters and a description. For example HISTOGRAM(MYHGRAM, 1, 10000, 50, EXPONENTIAL, &#8220;Time (ms) taken by shiny new metric&#8221;) defines a MYHGRAM histogram with a minimum value of 1, maximum 10000 and 50 buckets that grow exponentially with the description specifying units as milliseconds. 2a) C++:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>#include &lt;mozilla/Telemetry.h&gt;</span></code></pre></td></tr></table></div></figure>


<p>&#8230;. Telemetry::Accumulate(Telemetry::MYHGRAM, <some interestin integer value goes here>)</p>

<p>2b) JS:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>Telemetry = Cc["@mozilla.org/base/telemetry;1"].getService(Ci.nsITelemetry)
</span><span class='line'>var h = Telemetry.getHistogramById("MYHGRAM");
</span><span class='line'>h.Add(&lt;some interesting value goes here&gt;);
</span></code></pre></td></tr></table></div></figure>


<p>3) Install <a href="https://addons.mozilla.org/en-US/firefox/addon/abouttelemetry/">about:telemetry</a> addon, go to about:telemetry to check that the chosen histogram type and parameters summarize your data in a useful way.</p>

<p>4) Commit and wait for results to come in. <strong>FAQ</strong> <em>Q: What about those UMA</em>* macros?_ A: Don&#8217;t use them. I added TelemetryHistograms.h so telemetry can be easily reviewed by security and privacy police. It also avoids a few pitfalls such as accidentally initializing the same histogram with different parameters, etc.</p>

<p><em>Q: When will telemetry be deployed?</em> A: We will land the <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=652657">UI</a> to turn it on as soon as an updated <a href="http://www.mozilla.com/en-US/legal/privacy/firefox.html">privacy policy</a> is <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=664845">posted</a>. It should show up in nightly builds by the end of the week.</p>

<p><em>Q: How do I access the gathered telemetry data?</em> A: TBD. Data is stored on metrics server, we will figure this out soon.</p>

<p><em>Q: What about addons?</em> A: TBD. At the moment addons are free to inspect telemetry data in their browser. We haven&#8217;t decided on a process to let addon authors add new probes and access stats. For now, addons should not participate in telemetry.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/10/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/12/24/making-pages-load-faster/">Making pages load faster</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/21/interesting-bugzilla-activity/">Snappy #45: The view from home</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/17/hello-octopress/">Hello Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/26/coping-with-flash-hangs/">Coping with Flash hangs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/16/snappy-44-fixing-tab-switching-in-vancouver/">Snappy #44: Fixing tab switching in Vancouver</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("tarasglek", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tarasglek" class="twitter-follow-button" data-show-count="false">Follow @tarasglek</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p><h6>
  Copyright &copy; 2013 - Taras Glek - content on this site is licensed under the
Creative Commons Attribution Share-Alike License v3.0 or any later version.

  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span></h6>
</p>
<script>
//indicate that content has been loaded
window._monitorContentLoaded = Date.now()
</script>
<script src="http://monitor-taras-glek-net.appspot.com/static/monitor.js">
</script>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'allaboutperformance-tarasglek';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
